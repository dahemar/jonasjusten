<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Safari iOS Diagnostic</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .primary { background-color: #007bff; color: white; }
        .secondary { background-color: #6c757d; color: white; }
    </style>
</head>
<body>
    <h1>üîç Safari iOS Diagnostic Tool</h1>
    
    <div class="test-section">
        <h3>üì± Device Information</h3>
        <div id="device-info"></div>
    </div>
    
    <div class="test-section">
        <h3>üåê Network Tests</h3>
        <button class="primary" onclick="testNetwork()">Test Network Connection</button>
        <button class="secondary" onclick="testGoogleSheets()">Test Google Sheets API</button>
        <div id="network-results"></div>
    </div>
    
    <div class="test-section">
        <h3>üîß JavaScript Tests</h3>
        <button class="primary" onclick="testJavaScript()">Test JavaScript Features</button>
        <div id="js-results"></div>
    </div>
    
    <div class="test-section">
        <h3>üìä Debug Information</h3>
        <button class="secondary" onclick="showDebugInfo()">Show Debug Info</button>
        <div id="debug-info"></div>
    </div>

    <script>
        // Device Information
        function showDeviceInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink,
                    rtt: navigator.connection.rtt
                } : 'Not available',
                memory: navigator.deviceMemory || 'Not available',
                hardwareConcurrency: navigator.hardwareConcurrency || 'Not available'
            };
            
            document.getElementById('device-info').innerHTML = `
                <p><strong>User Agent:</strong> ${info.userAgent}</p>
                <p><strong>Platform:</strong> ${info.platform}</p>
                <p><strong>Language:</strong> ${info.language}</p>
                <p><strong>Cookies Enabled:</strong> ${info.cookieEnabled}</p>
                <p><strong>Online:</strong> ${info.onLine}</p>
                <p><strong>Connection:</strong> ${JSON.stringify(info.connection)}</p>
                <p><strong>Memory:</strong> ${info.memory}</p>
                <p><strong>CPU Cores:</strong> ${info.hardwareConcurrency}</p>
            `;
        }
        
        // Network Tests
        async function testNetwork() {
            const results = document.getElementById('network-results');
            results.innerHTML = '<p>Testing network connection...</p>';
            
            try {
                const start = Date.now();
                const response = await fetch('https://httpbin.org/get', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                const end = Date.now();
                
                if (response.ok) {
                    results.innerHTML = `
                        <div class="success">
                            <p>‚úÖ Network connection successful</p>
                            <p>Response time: ${end - start}ms</p>
                            <p>Status: ${response.status}</p>
                        </div>
                    `;
                } else {
                    results.innerHTML = `
                        <div class="error">
                            <p>‚ùå Network connection failed</p>
                            <p>Status: ${response.status}</p>
                        </div>
                    `;
                }
            } catch (error) {
                results.innerHTML = `
                    <div class="error">
                        <p>‚ùå Network connection error</p>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function testGoogleSheets() {
            const results = document.getElementById('network-results');
            results.innerHTML = '<p>Testing Google Sheets API...</p>';
            
            try {
                const url = 'https://sheets.googleapis.com/v4/spreadsheets/1RTrPB8qONlXQG37mRzPJ8aanTlxLGLy3MeYpsyKnmBk/values/Commercial!A2:B?key=AIzaSyBme4mQKxLVeqMxU3vPVT9Zj7KXwCgXjzY';
                const start = Date.now();
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                const end = Date.now();
                
                if (response.ok) {
                    const data = await response.json();
                    results.innerHTML = `
                        <div class="success">
                            <p>‚úÖ Google Sheets API successful</p>
                            <p>Response time: ${end - start}ms</p>
                            <p>Data rows: ${data.values ? data.values.length : 0}</p>
                        </div>
                    `;
                } else {
                    results.innerHTML = `
                        <div class="error">
                            <p>‚ùå Google Sheets API failed</p>
                            <p>Status: ${response.status}</p>
                        </div>
                    `;
                }
            } catch (error) {
                results.innerHTML = `
                    <div class="error">
                        <p>‚ùå Google Sheets API error</p>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // JavaScript Tests
        function testJavaScript() {
            const results = document.getElementById('js-results');
            const tests = [];
            
            // Test 1: Fetch API
            try {
                const fetchTest = typeof fetch !== 'undefined';
                tests.push({ name: 'Fetch API', result: fetchTest });
            } catch (e) {
                tests.push({ name: 'Fetch API', result: false, error: e.message });
            }
            
            // Test 2: Async/Await
            try {
                const asyncTest = (async () => {})();
                tests.push({ name: 'Async/Await', result: true });
            } catch (e) {
                tests.push({ name: 'Async/Await', result: false, error: e.message });
            }
            
            // Test 3: AbortController
            try {
                const abortTest = typeof AbortController !== 'undefined';
                tests.push({ name: 'AbortController', result: abortTest });
            } catch (e) {
                tests.push({ name: 'AbortController', result: false, error: e.message });
            }
            
            // Test 4: Console
            try {
                console.log('Test log');
                tests.push({ name: 'Console API', result: true });
            } catch (e) {
                tests.push({ name: 'Console API', result: false, error: e.message });
            }
            
            // Display results
            const html = tests.map(test => `
                <div class="${test.result ? 'success' : 'error'}">
                    <p>${test.result ? '‚úÖ' : '‚ùå'} ${test.name}: ${test.result ? 'Available' : 'Not available'}</p>
                    ${test.error ? `<p>Error: ${test.error}</p>` : ''}
                </div>
            `).join('');
            
            results.innerHTML = html;
        }
        
        // Debug Information
        function showDebugInfo() {
            const info = document.getElementById('debug-info');
            const debugData = {
                timestamp: new Date().toISOString(),
                url: window.location.href,
                referrer: document.referrer,
                screen: {
                    width: screen.width,
                    height: screen.height,
                    availWidth: screen.availWidth,
                    availHeight: screen.availHeight
                },
                window: {
                    innerWidth: window.innerWidth,
                    innerHeight: window.innerHeight,
                    outerWidth: window.outerWidth,
                    outerHeight: window.outerHeight
                },
                localStorage: typeof localStorage !== 'undefined',
                sessionStorage: typeof sessionStorage !== 'undefined',
                indexedDB: typeof indexedDB !== 'undefined'
            };
            
            info.innerHTML = `
                <div class="warning">
                    <p><strong>Debug Information:</strong></p>
                    <pre>${JSON.stringify(debugData, null, 2)}</pre>
                </div>
            `;
        }
        
        // Initialize
        showDeviceInfo();
    </script>
</body>
</html>
